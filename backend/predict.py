import numpy as np
import h5py
import matplotlib.pyplot as plt
import matplotlib
import scipy
from PIL import Image
from scipy import ndimage
from dnn_app_utils_v3 import *

parameters = {'W1': ([[0.01548397, -0.00907703, -0.00636902, ..., -0.00945796,
                       -0.00740074,  0.01051435],
                      [0.01236167,  0.00511601, -0.00362717, ...,  0.00734162,
                       -0.005071,  0.00053183],
                      [-0.00117796, -0.00181032,  0.00684651, ...,  0.00618346,
                       -0.00256239, -0.00536175],
                      ...,
                      [0.002165, -0.00243528,  0.01629442, ..., -0.01027639,
                       -0.01052598, -0.00194614],
                      [-0.00033404, -0.00378379, -0.00774001, ...,  0.02026729,
                       -0.00482296, -0.00026943],
                      [-0.01495705, -0.00716332,  0.0085818, ...,  0.01957941,
                       0.01448853,  0.00209992]]), 'b1': ([[6.34470850e-03],
                                                           [-8.40938664e-04],
                                                           [1.21002934e-03],
                                                           [-1.22246877e-04],
                                                           [6.33997062e-03],
                                                           [-3.10500058e-04],
                                                           [2.34413162e-03],
                                                           [-7.16829603e-04],
                                                           [-1.18078616e-03],
                                                           [6.01105380e-04],
                                                           [-4.00561610e-03],
                                                           [-4.08706632e-03],
                                                           [6.10010777e-04],
                                                           [1.42466671e-02],
                                                           [1.88677423e-03],
                                                           [6.39111357e-03],
                                                           [-5.55613787e-05],
                                                           [1.72532582e-03],
                                                           [-2.67653832e-04],
                                                           [-4.03192210e-03]]), 'W2': ([[2.40000246e-01, -3.76321766e-01, -3.93230268e-01,
                                                                                         -4.01479697e-02,  9.31195591e-02,  1.23087970e-01,
                                                                                         4.41838600e-01,  4.73974955e-02,  3.21396138e-02,
                                                                                         1.95412529e-01,  2.59994503e-01, -8.02240227e-01,
                                                                                         -2.19784597e-01,  1.78071338e-01, -2.21447666e-01,
                                                                                         2.28175032e-02,  1.16300118e-01,  4.38314570e-01,
                                                                                         1.08551108e-01, -2.99075079e-01],
                                                                                        [3.51840826e-01, -9.70103308e-02,  3.02098778e-01,
                                                                                         2.40660782e-01, -7.34082172e-02, -3.14112859e-01,
                                                                                         -2.71702559e-01,  3.84784846e-01, -1.02399776e-01,
                                                                                         4.56870698e-01, -8.71905816e-02,  5.78523694e-02,
                                                                                         5.35609576e-04,  4.57987747e-01,  1.45623423e-01,
                                                                                         -5.90492796e-01, -1.90273031e-01,  2.19725239e-01,
                                                                                         1.27884422e-01, -8.91342288e-02],
                                                                                        [3.16578075e-01,  2.00144660e-01, -5.13823011e-02,
                                                                                         6.78952943e-03,  3.17145175e-01, -1.68174487e-01,
                                                                                         -8.48753593e-03, -5.90897385e-02, -2.20361305e-01,
                                                                                         -3.25683419e-02, -6.03399975e-01,  3.67369652e-02,
                                                                                         5.05889618e-02,  4.06865544e-01,  5.25734162e-03,
                                                                                         -1.34804086e-01, -2.47913953e-01,  1.62864357e-01,
                                                                                         3.93479541e-01, -2.06862854e-01],
                                                                                        [1.32523835e-01, -2.55039834e-01,  3.87393051e-01,
                                                                                         1.76843032e-02, -6.81877992e-02, -3.77315263e-02,
                                                                                         -1.78599873e-01, -1.59661445e-01,  4.04119359e-03,
                                                                                         -1.29565854e-01,  3.72396082e-01, -3.48774403e-01,
                                                                                         -3.58530417e-03, -3.81729260e-01, -1.19432742e-01,
                                                                                         1.46532659e-01,  3.15454643e-01,  1.87980790e-01,
                                                                                         -4.81236860e-02, -1.31666782e-01],
                                                                                        [-1.65234888e-01,  3.95205555e-01, -5.81721150e-01,
                                                                                         1.54733402e-01, -3.13254633e-01,  3.37220275e-02,
                                                                                         -2.61159675e-01,  2.68137105e-01,  4.77073400e-01,
                                                                                         -1.76824909e-01, -1.41383558e-01, -7.72299667e-02,
                                                                                         3.01474087e-03, -2.87333072e-01,  4.86753716e-02,
                                                                                         -7.63885813e-02,  1.46650982e-01,  7.82642274e-02,
                                                                                         -1.47107319e-01, -3.94100085e-01],
                                                                                        [-2.43563662e-01,  9.67757626e-02,  1.78217271e-01,
                                                                                         2.02903173e-01,  1.55038234e-01,  2.65083664e-01,
                                                                                         -2.83318171e-02, -2.85896498e-01,  3.34187306e-01,
                                                                                         5.01439061e-02, -2.33706100e-01,  5.05610428e-02,
                                                                                         1.73461486e-02, -3.67221953e-01,  1.66391360e-01,
                                                                                         -3.51839521e-01, -6.48513070e-02, -3.03705308e-01,
                                                                                         1.20283910e-01, -3.79958755e-01],
                                                                                        [1.83253840e-01, -2.15791924e-01, -4.10389669e-01,
                                                                                         5.94620257e-02,  9.42323624e-02, -3.27625442e-01,
                                                                                         -9.07540308e-02, -6.13387021e-01,  1.99192291e-01,
                                                                                         -1.51380979e-01,  2.18128841e-02, -7.31430693e-02,
                                                                                         1.27294405e-01, -1.83780027e-02,  1.35841651e-01,
                                                                                         4.06414040e-01,  3.43874638e-01, -1.94200955e-02,
                                                                                         9.29958614e-02, -8.13279477e-02]]), 'b2': ([[1.24473518e-02],
                                                                                                                                     [1.14588253e-02],
                                                                                                                                     [1.61005166e-02],
                                                                                                                                     [-8.41069003e-03],
                                                                                                                                     [1.75120296e-05],
                                                                                                                                     [-4.66297254e-04],
                                                                                                                                     [1.11194879e-02]]), 'W3': ([[0.49344308,  0.52484568,  1.00774371, -1.07044531, -0.63999387,
                                                                                                                                                                  -0.17415354, -0.17546573],
                                                                                                                                                                 [-0.57745268,  0.41478755,  0.04255083, -0.13811036,  0.23409364,
                                                                                                                                                                  0.7506161, -0.34497099],
                                                                                                                                                                 [0.64408232,  0.55274505,  0.2555942,  0.2886692, -0.0644011,
                                                                                                                                                                  0.77599274, -0.12123685]]), 'b3': ([[-0.01523464],
                                                                                                                                                                                                      [0.00025634],
                                                                                                                                                                                                      [-0.03645792]]), 'W4': ([[1.12452679, 0.8807677, 1.71628566]]), 'b4': ([[-2.0956381]])}

num_px = 64
my_label_y = [1]
fname = "uploads/myImage-1641149431863.jpg"
image = np.array(Image.open(fname).resize((num_px, num_px)))
plt.imshow(image)
image = image / 255.
image = image.reshape((1, num_px * num_px * 3)).T

my_predicted_image = predict(image, my_label_y, parameters)

classes = ["cat", "non cat"]

print("y = " + str(np.squeeze(my_predicted_image)) + ", The L-layer model predicts a \"" +
      classes[int(np.squeeze(my_predicted_image))] + "\" picture.")
